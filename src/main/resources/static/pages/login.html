<!doctype html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>后台管理系统</title>
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<link rel="shortcut icon" href="./favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="/css/font.css">
		<link rel="stylesheet" href="/css/common.css" />
		<link rel="stylesheet" href="/css/login.css" />
	</head>

	<body class="login-bg">

		<div class="login">
			<div class="layui-tab" lay-filter="docDemoTabBrief">
				<ul class="layui-tab-title">
					<li class="layui-this">登陆</li>
					<li>注册</li>
				</ul>

				<div class="layui-tab-content" style="height: 100px;">
					<div class="layui-tab-item layui-show">
						<div class="login-logo">
						</div>
						<form method="post" class="layui-form">
							<div class="layui-input-inline">
								<div class="layui-inline">
									<i class="layui-icon iconfont">&#xe66f;</i>
									<input name="username" lay-verify="required" placeholder="用户名" type="text" class="layui-input">
								</div>
							</div>
							<hr class="hr20">
							<div class="layui-input-inline">
								<div class="layui-inline">
									<i class="layui-icon iconfont">&#xe673;</i>
									<input name="password" lay-verify="required" placeholder="密码" type="password" class="layui-input">
								</div>
							</div>
							<hr class="hr20">
							<div class="layui-input-inline">
								<div class="layui-inline">
									<i class="layui-icon iconfont">&#xe679;</i>
									<input name="idecode" lay-verify="required" placeholder="验证码" type="text" class="layui-input" style="width: 150px;float: left;"></div>
								<div class="layui-inline">
									<i class="layui-icon" id="it" style="color: green;font-weight: bolder;" hidden>&#xe605;</i>
								</div>
								<div class="layui-inline">
									<i class="layui-icon" id="if" style="color: red; font-weight: bolder;" hidden>&#x1006;</i>
								</div>
								<div class="layui-inline">
									<canvas id="canvas" width="100" height="50" style="float: left;margin-left: 20px;"></canvas>
								</div>
							</div>
							<hr class="hr20">
							<input class="loginin" value="登录" lay-submit lay-filter="login" style="width:100%;" type="submit">
							<hr class="hr20">
						</form>
					</div>
					<div class="layui-tab-item">
						<form method="post" class="layui-form">
							<div class="layui-input-inline">
								<div class="layui-inline">
									<i class="layui-icon iconfont">&#xe66f;</i>
									<input id="uname" name="username" lay-verify="required" placeholder="用户名" type="text" class="layui-input">
								</div>
								<div class="layui-inline judgetf">
									<i class="layui-icon" id="ut" style="color: green;font-weight: bolder;" hidden>&#xe605;</i>
								</div>
								<div class="layui-inline judgetf">
									<i class="layui-icon" id="uf" style="color: red; font-weight: bolder;" hidden>&#x1006;</i>
								</div>
							</div>
							<hr class="hr15">
							<div class="layui-input-inline">
								<div class="layui-inline">
									<i class="layui-icon iconfont">&#xe673;</i>
									<input id="pwd" name="password" lay-verify="required" placeholder="密码" type="password" class="layui-input">
								</div>
								<div class="layui-inline judgetf">
									<i class="layui-icon" id="pt" style="color: green;font-weight: bolder;" hidden>&#xe605;</i>
								</div>
								<div class="layui-inline judgetf">
									<i class="layui-icon" id="pf" style="color: red; font-weight: bolder;" hidden>&#x1006;</i>
								</div>
							</div>
							<hr class="hr15">
							<div class="layui-input-inline">
								<div class="layui-inline">
									<i class="layui-icon iconfont">&#xe673;</i>
									<input id="rpwd"  name="repassword" lay-verify="required" placeholder="确认密码" type="password" class="layui-input">
								</div>
								<div class="layui-inline judgetf">
									<i class="layui-icon" id="rpt" style="color: green;font-weight: bolder;" hidden>&#xe605;</i>
								</div>
								<div class="layui-inline judgetf">
									<i class="layui-icon" id="rpf" style="color: red; font-weight: bolder;" hidden>&#x1006;</i>
								</div>
							</div>
							<hr class="hr15">
							<div class="layui-input-inline">
								<div class="layui-inline">
									<i class="layui-icon iconfont">&#xe674;</i>
									<input id="email" name="email" lay-verify="required" placeholder="邮箱" type="text" class="layui-input">
								</div>
								<div class="layui-inline judgetf">
									<i class="layui-icon" id="et" style="color: green;font-weight: bolder;" hidden>&#xe605;</i>
								</div>
								<div class="layui-inline judgetf">
									<i class="layui-icon" id="ef" style="color: red; font-weight: bolder;" hidden>&#x1006;</i>
								</div>
							</div>
							<hr class="hr15">
							<input class="register" value="注册" lay-submit lay-filter="login" style="width:100%;" type="submit">
							<hr class="hr20">
						</form>
					</div>
				</div>
			</div>

		</div>

		<script type="text/javascript" src="/lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="/js/three.min.js"></script>
		<script type="text/javascript">
			//动态背景
			var SEPARATION = 100,
				AMOUNTX = 50,
				AMOUNTY = 50;

			var container;
			var camera, scene, renderer;

			var particles, particle, count = 0;

			var mouseX = 0,
				mouseY = -500;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

			init();
			animate();

			function init() {

				container = document.createElement('div');
				document.body.appendChild(container);

				container.style.position = "absolute";
				container.style.top = "0px";
				container.style.left = "0px";

				camera = new THREE.PerspectiveCamera(85, window.innerWidth / window.innerHeight, 1, 10000);
				camera.position.z = 1000;

				scene = new THREE.Scene();

				particles = new Array();

				var PI2 = Math.PI * 2;
				var material = new THREE.ParticleCanvasMaterial({

					color: 0xffffff,
					program: function(context) {

						context.beginPath();
						context.arc(0, 0, 1, 0, PI2, true);
						context.fill();

					}

				});

				var i = 0;

				for(var ix = 0; ix < AMOUNTX; ix++) {

					for(var iy = 0; iy < AMOUNTY; iy++) {

						particle = particles[i++] = new THREE.Particle(material);
						particle.position.x = ix * SEPARATION - ((AMOUNTX * SEPARATION) / 2);
						particle.position.z = iy * SEPARATION - ((AMOUNTY * SEPARATION) / 2);
						scene.add(particle);

					}

				}

				renderer = new THREE.CanvasRenderer();
				renderer.setSize(window.innerWidth, window.innerHeight);
				container.appendChild(renderer.domElement);

				document.addEventListener('mousemove', onDocumentMouseMove, false);
				document.addEventListener('touchstart', onDocumentTouchStart, false);
				document.addEventListener('touchmove', onDocumentTouchMove, false);

				//

				window.addEventListener('resize', onWindowResize, false);

			}

			function onWindowResize() {

				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize(window.innerWidth, window.innerHeight);

			}

			//

			function onDocumentMouseMove(event) {

				mouseX = event.clientX - windowHalfX;
				mouseY = event.clientY - windowHalfY;

			}

			function onDocumentTouchStart(event) {

				if(event.touches.length === 1) {

					event.preventDefault();

					mouseX = event.touches[0].pageX - windowHalfX;
					mouseY = event.touches[0].pageY - windowHalfY;

				}

			}

			function onDocumentTouchMove(event) {

				if(event.touches.length === 1) {

					event.preventDefault();

					mouseX = event.touches[0].pageX - windowHalfX;
					mouseY = event.touches[0].pageY - windowHalfY;

				}

			}

			//

			function animate() {

				requestAnimationFrame(animate);

				render();

			}

			function render() {

				camera.position.x += (mouseX - camera.position.x) * .05;
				camera.position.y += (-mouseY - camera.position.y) * .05;
				camera.lookAt(scene.position);

				var i = 0;

				for(var ix = 0; ix < AMOUNTX; ix++) {

					for(var iy = 0; iy < AMOUNTY; iy++) {

						particle = particles[i++];
						particle.position.y = (Math.sin((ix + count) * 0.3) * 50) + (Math.sin((iy + count) * 0.5) * 50);
						particle.scale.x = particle.scale.y = (Math.sin((ix + count) * 0.3) + 1) * 2 + (Math.sin((iy + count) * 0.5) + 1) * 2;

					}

				}

				renderer.render(scene, camera);

				count += 0.1;

			}
		</script>

		<div style="position: absolute; top: 0px; left: 0px;transform: translateZ(0);">
			<canvas width="1920" height="485" style="width: 1920px; height: 485px;"></canvas>
		</div>

		<script type="text/javascript">
			layui.extend({
				admin: '{/}js/admin'
			});
			layui.use(['form', 'admin'], function() {
				var form = layui.form,
					admin = layui.admin;
				$ = layui.jquery;
				// layer.msg('玩命卖萌中', function(){
				//   //关闭后的操作
				//   });
				//监听提交
				form.on('submit(login)', function(data) {
					// alert(888)
					layer.msg(JSON.stringify(data.field), function() {
						location.href = './index.html'
					});
					return false;
				});

				//验证用户名是否可用
				$('#uname').blur(function() {
					var uname = $(this).val();
					if(uname == "")return;
					if(uname == 1) {
						$('#ut').removeAttr('hidden');
						$('#uf').attr('hidden', 'hidden');
					} else {
						$('#uf').removeAttr('hidden');
						$('#ut').attr('hidden', 'hidden');
						layer.msg('当前用户名已被占用! ')
					}
					//alert(user);
//					$.ajax({
//						url: '#',
//						type: 'post',
//						dataType: 'text',
//						data: {
//							user: user
//						},
//						success: function(data) {
//							if(user == 1) {
//								$('#ut').removeAttr('hidden');
//								$('#uf').attr('hidden', 'hidden');
//							} else {
//								$('#uf').removeAttr('hidden');
//								$('#ut').attr('hidden', 'hidden');
//								layer.msg('当前用户名已被占用! ')
//
//							}
//
//						}
//					})
				});
				
				// 为密码添加正则验证
		        $('#pwd').blur(function() {
		        	var reg = /^[\w]{6,12}$/;
		        	var pwd = $(this).val();
					if(pwd == "")return;
		        	if(!($('#pwd').val().match(reg))) {
		        		//layer.msg('请输入合法密码');
		        		$('#pf').removeAttr('hidden');
		        		$('#pt').attr('hidden', 'hidden');
		        		layer.msg('请输入合法密码');
		        	} else {
		        		$('#pt').removeAttr('hidden');
		        		$('#pf').attr('hidden', 'hidden');
		        	}
		        });
		        
		        //验证两次密码是否一致
		        $('#rpwd').blur(function() {
		        	var rpwd = $(this).val();
					if(rpwd == "")return;
		        	if($('#pwd').val() != $('#rpwd').val()) {
		        		$('#rpf').removeAttr('hidden');
		        		$('#rpt').attr('hidden', 'hidden');
		        		layer.msg('两次输入密码不一致!');
		        	} else {
		        		$('#rpt').removeAttr('hidden');
		        		$('#rpf').attr('hidden', 'hidden');
		        	};
		        });
		        
		        // 为邮箱添加正则验证
		        $('#email').blur(function() {
		        	var reg = /^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/;
		        	var email = $(this).val();
					if(email == "")return;
		        	if(!($('#email').val().match(reg))) {
		        		$('#ef').removeAttr('hidden');
		        		$('#et').attr('hidden', 'hidden');
		        		layer.msg('请检查邮箱的格式');
		        	} else {
		        		$('#et').removeAttr('hidden');
		        		$('#ef').attr('hidden', 'hidden');
		        	}
		        });

		        $(function() {
		        	var show_num = [];
		        	draw(show_num);//验证码校验
					$("#canvas").on('click', function() {
						draw(show_num);
					})
					$(".loginin").on('click', function() {
						var val = $(".layui-input[name=idecode]").val().toLowerCase();
						console.log(val);
						var num = show_num.join("");
						if(val == '') {
							alert('请输入验证码！');
						} else if(val == num) {
							alert('提交成功！');
							$(".input-val").val('');
							draw(show_num);

						} else {
							alert('验证码错误！请重新输入！');
							$(".input-val").val('');
							draw(show_num);
						}
					})

				})

				function draw(show_num) { //验证码生成
					var canvas_width = $('#canvas').width();
					var canvas_height = $('#canvas').height();
					var canvas = document.getElementById("canvas"); //获取到canvas的对象，演员
					var context = canvas.getContext("2d"); //获取到canvas画图的环境，演员表演的舞台
					canvas.width = canvas_width;
					canvas.height = canvas_height;
					var sCode = "A,B,C,E,F,G,H,J,K,L,M,N,P,Q,R,S,T,W,X,Y,Z,1,2,3,4,5,6,7,8,9,0";
					var aCode = sCode.split(",");
					var aLength = aCode.length; //获取到数组的长度

					for(var i = 0; i <= 3; i++) {
						var j = Math.floor(Math.random() * aLength); //获取到随机的索引值
						var deg = Math.random() * 30 * Math.PI / 180; //产生0~30之间的随机弧度
						var txt = aCode[j]; //得到随机的一个内容
						show_num[i] = txt.toLowerCase();
						var x = 10 + i * 20; //文字在canvas上的x坐标
						var y = 24 + Math.random() * 8; //文字在canvas上的y坐标
						context.font = "bold 23px 微软雅黑";

						context.translate(x, y);
						context.rotate(deg);

						context.fillStyle = randomColor();
						context.fillText(txt, 0, 0);

						context.rotate(-deg);
						context.translate(-x, -y);
					}
					for(var i = 0; i <= 5; i++) { //验证码上显示线条
						context.strokeStyle = randomColor();
						context.beginPath();
						context.moveTo(Math.random() * canvas_width, Math.random() * canvas_height);
						context.lineTo(Math.random() * canvas_width, Math.random() * canvas_height);
						context.stroke();
					}
					for(var i = 0; i <= 30; i++) { //验证码上显示小点
						context.strokeStyle = randomColor();
						context.beginPath();
						var x = Math.random() * canvas_width;
						var y = Math.random() * canvas_height;
						context.moveTo(x, y);
						context.lineTo(x + 1, y + 1);
						context.stroke();
					}
				}

				function randomColor() { //得到随机的颜色值
					var r = Math.floor(Math.random() * 256);
					var g = Math.floor(Math.random() * 256);
					var b = Math.floor(Math.random() * 256);
					return "rgb(" + r + "," + g + "," + b + ")";
				}

			});
		</script>

	</body>

</html>